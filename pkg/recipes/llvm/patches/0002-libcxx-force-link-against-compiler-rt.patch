From 06e2f481f190cce6ba3329e53f2583335be756c0 Mon Sep 17 00:00:00 2001
From: mssx86 <mss@tutanota.de>
Date: Sun, 29 Aug 2021 07:35:40 +0300
Subject: [PATCH 2/7] libcxx: force link against compiler-rt.

---
 libcxx/src/CMakeLists.txt | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/libcxx/src/CMakeLists.txt b/libcxx/src/CMakeLists.txt
index 496429f38..78b34f464 100644
--- a/libcxx/src/CMakeLists.txt
+++ b/libcxx/src/CMakeLists.txt
@@ -195,6 +195,11 @@ if (LIBCXX_ENABLE_SHARED)
   add_library(cxx_shared SHARED ${exclude_from_all} ${LIBCXX_SOURCES} ${LIBCXX_HEADERS})
   target_link_libraries(cxx_shared PUBLIC cxx-headers
                                    PRIVATE ${LIBCXX_LIBRARIES})
+
+  if (LIBCXX_USE_COMPILER_RT)
+    target_link_libraries(cxx_shared PRIVATE ${LIBCXX_BUILTINS_LIBRARY})
+  endif()
+
   set_target_properties(cxx_shared
     PROPERTIES
       COMPILE_FLAGS "${LIBCXX_COMPILE_FLAGS}"
@@ -273,6 +278,11 @@ if (LIBCXX_ENABLE_STATIC)
   add_library(cxx_static STATIC ${exclude_from_all} ${LIBCXX_SOURCES} ${LIBCXX_HEADERS})
   target_link_libraries(cxx_static PUBLIC cxx-headers
                                    PRIVATE ${LIBCXX_LIBRARIES})
+
+  if (LIBCXX_USE_COMPILER_RT)
+    target_link_libraries(cxx_static PRIVATE ${LIBCXX_BUILTINS_LIBRARY})
+  endif()
+
   set_target_properties(cxx_static
     PROPERTIES
       COMPILE_FLAGS "${LIBCXX_COMPILE_FLAGS}"
-- 
2.33.0

