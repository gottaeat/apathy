# >> 1
pdir="/mss/repo/pkg-management/patches/ffmpeg-4.3.1/"
patch -p1 < "${pdir}"/0001-libavutil-clean-up-unused-FF_SYMVER-macro.patch

sed -i 's/-lflite"/-lflite -lasound"/' configure

# >> 2
mkdir build
cd    build

export       CC="clang"
export      CXX="clang++"
export       LD="ld.lld"
export       AR="llvm-ar"
export       AS="llvm-as"
export       NM="llvm-nm"
export    STRIP="llvm-strip"
export   RANLIB="llvm-ranlib"
export  OBJCOPY="llvm-objcopy"
export  OBJDUMP="llvm-objdump"
export  OBJSIZE="llvm-size"
export  READELF="llvm-readelf"

export   CFLAGS="-w -O3 -mtune=native -march=native -fstack-protector-strong -fuse-ld=lld -mllvm -polly -flto=full -flto-jobs=2"
export CXXFLAGS="${CFLAGS}"
export  LDFLAGS="${CFLAGS} -Wl,--as-needed -Wl,--gc-sections -Wl,-O2 -Wl,--icf=all -Wl,--lto-O3"

../configure \
 --nm="${NM}"                    \
 --ar="${AR}"                    \
 --as="${CC}"                    \
 --strip="${STRIP}"              \
 --cc="${CC}"                    \
 --cxx="${CXX}"                  \
 --objcc="${CC}"                 \
 --dep-cc="${CC}"                \
 --ld="${CC}"                    \
 --ranlib="${RANLIB}"            \
\
 --extra-cflags="${CFLAGS}"      \
 --extra-cxxflags="${CXXFLAGS}"  \
 --extra-objcflags="${CFLAGS}"   \
 --extra-ldflags="${LDFLAGS}"    \
 --extra-ldexeflags="${LDFLAGS}" \
 --extra-ldsoflags="${LDFLAGS}"  \
 --enable-pic                    \
\
 --disable-doc                   \
 --disable-htmlpages             \
 --disable-manpages              \
 --disable-podpages              \
 --disable-txtpages              \
\
 --prefix=/usr                   \
 --enable-gpl                    \
 --enable-shared                 \
 --enable-version3               \
\
 --enable-avx                    \
 --enable-avx2                   \
 --enable-avx512                 \
 --disable-debug                 \
 --disable-static                \
\
 --enable-gnutls                 \
 --enable-libass                 \
 --enable-libdrm                 \
 --enable-libfontconfig          \
 --enable-libfreetype            \
 --enable-libfribidi             \
 --enable-libmp3lame             \
 --enable-libopenjpeg            \
 --enable-libopus                \
 --enable-libvpx                 \
 --enable-libwebp                \
 --enable-libx264                \
 --enable-libx265                \
 --enable-libxml2                \
 --enable-opengl                 \
\
 --disable-libcaca               \
 --disable-librsvg               \
 --disable-libv4l2               \
 --disable-v4l2-m2m              \
 --disable-outdev=oss,v4l2       \
 --disable-indev=oss,v4l2
